<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Universal RPG</title>
  <style>
    body {
  font-family: "Segoe UI", Tahoma, Arial, sans-serif;
  background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
  color: #eee;
  text-align: center;
  margin: 0;
  padding: 0;
}

h1 {
  color: #4caf50;
  text-shadow: 0 0 8px rgba(76, 175, 80, 0.6);
  margin-top: 20px;
}

.menu, .battle, .shop {
  display: none;
  margin-top: 20px;
}

/* üéØ Wyb√≥r cel√≥w ataku */
#targetSelect {
  margin: 20px auto;
  padding: 15px;
  background: #1b1b1b;
  border: 2px solid #4caf50;
  border-radius: 14px;
  width: 70%;
  color: #eee;
  box-shadow: 0 0 12px rgba(76, 175, 80, 0.2);
}

.target-row {
  margin: 10px 0;
  padding: 10px;
  background: #222;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: background 0.3s;
}

.target-row:hover {
  background: #2c2c2c;
}

.target-row b {
  color: #4caf50;
}

/* üé® Karty */
.card {
  border: 2px solid #4caf50;
  border-radius: 14px;
  padding: 15px;
  margin: 15px;
  display: inline-block;
  background: #222;
  width: 190px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 16px rgba(76,175,80,0.4);
}

/* üé® Przyciski */
button {
  padding: 10px 18px;
  margin: 6px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s ease;
}

button:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

.green {
  background: linear-gradient(135deg, #43a047, #66bb6a);
  color: #fff;
}

.purple {
  background: linear-gradient(135deg, #7e57c2, #9575cd);
  color: #fff;
}

.red {
  background: linear-gradient(135deg, #e53935, #ef5350);
  color: #fff;
}

.blue {
  background: linear-gradient(135deg, #1e88e5, #42a5f5);
  color: #fff;
}

.yellow {
  background: linear-gradient(135deg, #fdd835, #fbc02d);
  color: #000;
  font-weight: bold;
}

/* üéØ Select ataku */
.target-select {
  padding: 6px 10px;
  background: #333;
  border: 1px solid #4caf50;
  border-radius: 8px;
  color: #fff;
  cursor: pointer;
  transition: background 0.2s, color 0.2s;
}

.target-select:hover {
  background: #4caf50;
  color: #000;
}
  </style>
</head>
<body>
  <h1>Universal RPG</h1>
  
<div id="mainMenu">
  <p>Wybierz do 3 postaci</p>
  <div id="characterSelect"></div>

  <h3>Twoja dru≈ºyna:</h3>
  <div id="teamDisplay"></div>

  <p>üíµ <span id="mainMoney">0</span></p>
  <button class="green" onclick="startGame()">Start Gry</button>
  <button class="blue" onclick="openShop()">Sklep</button>
  <button class="red" onclick="resetGame()">Reset gry</button>
  <button class="white" onclick="openInventory()">üéí Ekwipunek</button>
  <button class="purple" onclick="openCrafting()">üß™ Crafting</button>
  <button class="yellow" onclick="openSettings()">Ustawienia</button>
</div>

<!-- EKRAN USTAWIE≈É -->
<div id="settingsScreen" style="display:none;">
  <h2>‚öôÔ∏è Ustawienia</h2>

  <button id="toggleSoundsBtn" onclick="toggleCharacterSounds()">üîä D≈∫wiƒôki postaci: W≈ÇƒÖczone</button>
  <br><br>

  <button onclick="resetGameProgress()" style="background:red; color:white;">Resetuj grƒô</button>
  <br><br>
  <button onclick="backToMenu()">‚¨Ö Powr√≥t</button>
</div>

<div id="craftingScreen" style="display:none;">
  <h2>üß™ Crafting</h2>
  <div id="craftingList"></div>
  <button class="blue" onclick="showScreen('mainMenu')">‚Üê Powr√≥t</button>
</div>

<div id="inventoryScreen" style="display:none;">
  <h2>üéí Ekwipunek</h2>
  <div id="inventoryList"></div>
  <button class="blue" onclick="showScreen('mainMenu')">‚Üê Powr√≥t</button>
</div>

<div id="mapSelect" style="display:none; margin-top:20px;">
  <h2>Wybierz planszƒô</h2>
  <div>
    <button onclick="chooseMap('minecraft')">Minecraft</button>
    <button onclick="chooseMap('fnaf')">FnaF</button>
    <button onclick="chooseMap('poppy')">Poppy Playtime</button>
    <button onclick="chooseMap('doors')">Doors</button>
    <button onclick="chooseMap('dc')">DC</button>
    <button onclick="chooseMap('marver')">Marver</button>
    <button onclick="chooseMap('furas')">Furasy</button>
    <button onclick="chooseMap('starwars')">Star Wars</button>
    <button onclick="chooseMap('banban')">Garden Of BanBan</button>
    <button onclick="chooseMap('bendy')">Bendy</button>
    <button onclick="chooseMap('theowlhouse')">Sowi Dom</button>
    <button onclick="chooseMap('legoninjago')">Lego Ninjago</button>
    <button onclick="chooseMap('hazbinhotel')">Hazbin Hotel</button>
    <button onclick="chooseMap('brawlstars')">Brawl Stsrs</button>
    <button onclick="chooseMap('99')">99 Night in the forest</button>
    <button onclick="chooseMap('sonic')">Sonic</button>
    <button onclick="chooseMap('wednesday')">Wednesday</button>
    <button onclick="chooseMap('theshadow')">The Shadow</button>
  </div>
  <br>
  <button class="red" onclick="cancelMapSelect()">Anuluj</button>
</div>

<div class="battle" id="battleScreen">
  <h2>Poziom <span id="levelNum"></span></h2>
  <div id="playerStats"></div>
  <div id="enemyStats"></div>
  <div id="targetSelect"></div>
  <button class="green" onclick="attack()">Atakuj</button>
  <div id="battleLog"></div>
</div>
  
  <div class="shop" id="shopScreen">
    <h2>Sklep</h2>
    <div id="shopOffer"></div>
    <div id="shopItems"></div>
    <p>üíµ <span id="money">0</span></p>    
    <button class="blue" onclick="closeShop()">Powr√≥t</button>
  </div>
  
  <audio id="attackSound" src="attack.mp3"></
    audio>
  
  <script>
    const baseCharacters = [
      { name: "Dawid", atk: 3, hp: 20 }
    ];

const enemiesMinecraft = [
  { name: "Alex", hp: 20, atk: 1, reward: 1 },
  { name: "Allay", hp: 5, atk: 1, reward: 1 },
  { name: "Axolotl", hp: 6, atk: 1, reward: 1 },
  { name: "Bat", hp: 4, atk: 1, reward: 1 },
  { name: "Bee", hp: 4, atk: 1, reward: 1 },
  { name: "Blaze", hp: 16, atk: 6, reward: 6 },
  { name: "Breeze", hp: 16, atk: 8, reward: 8 },
  { name: "Brutal Piglin", hp: 20, atk: 9, reward: 9 },
  { name: "Camel", hp: 30, atk: 1, reward: 1 },
  { name: "Cat", hp: 10, atk: 1, reward: 1 },
  { name: "Cave Spider", hp: 16, atk: 4, reward: 4, sound: "spider.mp3" },
  { name: "Charged Creeper", hp: 20, atk: 20, sound: "creeper.mp3" },
  { name: "Cow", hp: 8, atk: 1, reward: 1, sound: "cow.mp3" },
  { name: "Creacing", hp: 40, atk: 7, reward: 7, sound: "creaking.mp3" },
  { name: "Creeper", hp: 20, atk: 10, reward: 10, sound: "creeper.mp3" },
  { name: "Enderman", hp: 40, atk: 3, reward: 3, sound: "enderman.mp3" },
  { name: "Ghast", hp: 16, atk: 6, reward: 6, sound: "ghast.mp3" },
  { name: "Happy Ghast", hp: 16, atk: 3, reward: 3, sound: "happy_ghast.mp3" },
  { name: "Iron Golem", hp: 40, atk: 8, reward: 8 },
  { name: "Pig", hp: 8, atk: 1, reward: 1, sound: "pig.mp3" },
  { name: "Skeleton", hp: 20, atk: 5, reward: 5, sound: "skeleton.mp3" },
  { name: "Spider", hp: 16, atk: 4, reward: 4, sound: "spider.mp3" },
  { name: "Steve", hp: 20, atk: 1, reward: 1 },
  { name: "Withered Skeleton", hp: 20, atk: 5, reward: 5, sound: "skeleton.mp3" },
  { name: "Zombie", hp: 20, atk: 3, reward: 3, sound: "zombie.mp3" }
];

const enemiesFnaf = [
  { name: "Afton", hp: 50, atk: 8, reward: 8 },
  { name: "Balloon Boy", hp: 40, atk: 2, reward: 2 },
  { name: "Barola", hp: 25, atk: 7, reward: 7 },
  { name: "Big Top", hp: 40, atk: 8, reward: 8 },
  { name: "Blob", hp: 40, atk: 8, reward: 8 },
  { name: "Bon Bon", hp: 15, atk: 1, reward: 1 },
  { name: "Burntrap", hp: 60, atk: 9, reward: 9 },
  { name: "Bonnie", hp: 30, atk: 2, reward: 2, sound: "bonnie.mp3" },
  { name: "Chica", hp: 30, atk: 2, reward: 2, sound: "chica.mp3" },
  { name: "Foxy", hp: 30, atk: 6, reward: 6, sound: "foxy.mp3" },
  { name: "Freddy", hp: 30, atk: 3, reward: 3, sound: "freddy.mp3" },
  { name: "Golden Freddy", hp: 32, atk: 6, reward: 6, sound: "golden_freddy.mp3" },
  { name: "Mangle", hp: 17, atk: 5, reward: 5, sound: "mangle.mp3" },
  { name: "Puppet", hp: 50, atk: 5, reward: 5, sound: "puppet.mp3" },
  { name: "Toy Freddy", hp: 17, atk: 2, reward: 2, sound: "toy.mp3" },
  { name: "Toy Chica", hp: 17, atk: 2, reward: 2, sound: "toy.mp3" },
  { name: "Toy Bonnie", hp: 17, atk: 2, reward: 2, sound: "toy.mp3" },
];

const enemiesHazbinHotel = [
  { name: "Alastor", hp: 60, atk: 6, reward: 6 },
  { name: "Charlie", hp: 20, atk: 7, reward: 7 },
  { name: "Kee Kee", hp: 12, atk: 3, reward: 3 },
  { name: "Vox", hp: 47, atk: 7, reward: 7, sound: "vox.mp3" }
];

const enemiesLegoNinjago = [
  { name: "Acronix", hp: 20, atk: 7, reward: 7 },
  { name: "Arin", hp: 10, atk: 8, reward: 8 },
  { name: "Cole", hp: 10, atk: 8, reward: 8 },
  { name: "Cryptor", hp: 40, atk: 5, reward: 5 }
];

const enemiesDoors = [
  { name: "Ambush", hp: 10, atk: 20, reward: 20 },
  { name: "Rush", hp: 5, atk: 10, reward: 10 },
  { name: "Seek", hp: 32, atk: 6, reward: 10 }
];

const enemiesTheShadow = [
  { name: "Cartoon Bunny", hp: 70, atk: 6, reward: 6 },
  { name: "Red Man", hp: 20, atk: 2, reward: 2 },
  { name: "Stickman", hp: 10, atk: 1, reward: 1 },
  { name: "White Rabbit", hp: 60, atk: 7, reward: 7 }
];

const enemiesTheOwlHouse = [
  { name: "Alador Plaga", hp: 20, atk: 6, reward: 6 },
  { name: "Anita", hp: 20, atk: 5, reward: 5 },
  { name: "Belos", hp: 40, atk: 2, reward: 2 }
];

const enemiesDc = [
  { name: "Batgirl", hp: 20, atk: 4, reward: 4 },
  { name: "Batman", hp: 20, atk: 6, reward: 6 }
];

const enemiesWednesday = [
  { name: "Enit", hp: 30, atk: 9, reward: 9 },
  { name: "Wednesday", hp: 30, atk: 7, reward: 7 }
];

const enemiesStarWars = [
  { name: "Analin Skywalker", hp: 20, atk: 5, reward: 5 },
  { name: "Boba Fett", hp: 40, atk: 8, reward: 8 },
  { name: "Jango Fett", hp: 20, atk: 4, reward: 4 }
];

const enemies99 = [
  { name: "Arctic Fox", hp: 12, atk: 4, reward: 4 },
  { name: "Bear", hp: 20, atk: 8, reward: 8 },
  { name: "The Deer", hp: 90, atk: 7, reward: 7 }
];

const enemiesBendy = [
  { name: "Bendy", hp: 20, atk: 5, reward: 5 },
  { name: "Borys", hp: 20, atk: 2, reward: 2 },
  { name: "Ink Demon", hp: 35, atk: 10, reward: 10 }
];

const enemiesBanBan = [
  { name: "Ban Ban", hp: 20, atk: 3, reward: 3 },
  { name: "Evil Ban Ban", hp: 40, atk: 6, reward: 6 },
  { name: "Nab Nab", hp: 20, atk: 3, reward: 3 }
];

const enemiesFuras = [
  { name: "Cz≈Çowiek Pies", hp: 20, atk: 2, reward: 2 },
  { name: "Cz≈Çowiek Wilk", hp: 20, atk: 6, reward: 6 },
  { name: "Cz≈Çowiek Lis", hp: 20, atk: 5, reward: 5 },
  { name: "Cz≈Çowiek Kto", hp: 20, atk: 3, reward: 3 }
];

const enemiesMarver = [
  { name: "Capitan Ameryca", hp: 20, atk: 8, reward: 8 },
  { name: "Spiderman", hp: 24, atk: 5, reward: 5 }
];

const enemiesPoppy = [
  { name: "Candy Cat", hp: 12, atk: 2, reward: 2 },
  { name: "Cat Nap", hp: 40, atk: 7, reward: 7 },
  { name: "Huggy Wuggy", hp: 60, atk: 8, reward: 8 }
];

const enemiesBrawlStart = [
  { name: "Bo", hp: 20, atk: 8, reward: 8 },
  { name: "Buzz", hp: 20, atk: 7, reward: 7 },
  { name: "Colt", hp: 20, atk: 3, reward: 3 }
];

const enemiesSonic = [
  { name: "Amy", hp: 10, atk: 8, reward: 8 },
  { name: "Shadow", hp: 10, atk: 5, reward: 5 },
  { name: "Sonic", hp: 10, atk: 5, reward: 5 },
  { name: "Tails", hp: 10, atk: 3, reward: 3 }
];

const shopCharacters = [
  { name: "Adam", cost: 180, atk: 6, hp: 30 },
  { name: "B≈Ça≈ºej", cost: 320, atk: 8, hp: 40 },
  { name: "Czarek", cost: 320, atk: 8, hp: 40 },
  { name: "Damianek", cost: 72, atk: 4, hp: 18 },
  { name: "Dorian", cost: 66, atk: 3, hp: 22 },
  { name: "Ewa1", cost: 192, atk: 8, hp: 24 },
  { name: "Ewa2", cost: 67, atk: 3, hp: 22, heal: 1 },
  { name: "Filip", cost: 85, atk: 5, hp: 17 },
  { name: "Franek", cost: 100, atk: 5, hp: 20 },
  { name: "Gabriel", cost: 140, atk: 7, hp: 20 },
  { name: "Gabrysia", cost: 44, atk: 2, hp: 22 },
  { name: "Hubert", cost: 200, atk: 5, hp: 40 },
  { name: "Janek", cost: 105, atk: 5, hp: 21 },
  { name: "Julka", cost: 67, atk: 1, hp: 37, heal: 3 },
  { name: "Jurek", cost: 160, atk: 4, hp: 40 },
  { name: "Kacper1", cost: 100, atk: 5, hp: 20 },
  { name: "Kacper2", cost: 80, atk: 4, hp: 20 },
  { name: "Kacper3", cost: 160, atk: 8, hp: 20 },
  { name: "Kajetan", cost: 72, atk: 4, hp: 18 },
  { name: "Karol", cost: 104, atk: 4, hp: 26 },
  { name: "Ksawery", cost: 85, atk: 5, hp: 17 },
  { name: "Kuba1", cost: 240, atk: 6, hp: 40 },
  { name: "Kuba2", cost: 104, atk: 4, hp: 26 },
  { name: "Kuba3", cost: 120, atk: 6, hp: 20 },
  { name: "Lena1", cost: 84, atk: 7, hp: 12 },
  { name: "Lena2", cost: 82, atk: 2, hp: 40, heal: 2 },
  { name: "≈Åukasz", cost: 90, atk: 6, hp: 15 },
  { name: "Maciej", cost: 200, atk: 5, hp: 40 },
  { name: "Maciek", cost: 80, atk: 4, hp: 20 },
  { name: "Miko≈Çaj", cost: 80, atk: 4, hp: 20 },
  { name: "Milena", cost: 196, atk: 7, hp: 28 },
  { name: "Natalka", cost: 47, atk: 2, hp: 23, heal: 1 },
  { name: "Natan", cost: 63, atk: 3, hp: 21 },
  { name: "Nataniel", cost: 400, atk: 10, hp: 40 },
  { name: "Nikola", cost: 203, atk: 7, hp: 29 },
  { name: "Ola", cost: 58, atk: 4, hp: 12, stun: { duration: 2, cooldown: 5, lastUsed: -5 } },
  { name: "Oli", cost: 99, atk: 3, hp: 33 },
  { name: "Oliwia", cost: 140, atk: 7, hp: 20 },
  { name: "Oliwier", cost: 240, atk: 8, hp: 30 },
  { name: "Oskar", cost: 45, atk: 2, hp: 22, heal: 1 },
  { name: "Oski", cost: 198, atk: 9, hp: 22 },
  { name: "Piotrek", cost: 320, atk: 8, hp: 40 },
  { name: "Pola", cost: 90, atk: 3, hp: 30 },
  { name: "Radek", cost: 240, atk: 8, hp: 30 },
  { name: "Rashana", cost: 62, atk: 3, hp: 20, heal: 2 },
  { name: "Rosti", cost: 60, atk: 3, hp: 20 },
  { name: "Roxana", cost: 80, atk: 2, hp: 40 },
  { name: "S≈Çawek", cost: 138, atk: 6, hp: 30 },
  { name: "Sta≈õ", cost: 72, atk: 4, hp: 18 },
  { name: "Sylwia", cost: 96, atk: 4, hp: 24 },
  { name: "Szymon", cost: 60, atk: 2, hp: 30 },
  { name: "Wiktoria", cost: 252, atk: 9, hp: 28 },
  { name: "Wojtek1", cost: 125, atk: 5, hp: 25 },
  { name: "Wojtek2", cost: 175, atk: 7, hp: 25 },
  { name: "Xantia", cost: 42, atk: 2, hp: 20, heal: 2 },
  { name: "Zuzia", cost: 162, atk: 8, hp: 19, stun: { duration: 2, cooldown: 5, lastUsed: -5 } }
];

const enemyDrops = {
  "Acronix": { item: "Ostrze Czasu", chance: 0.01 },
  "Afton": { item: "Ucho Kr√≥lika", chance: 0.35 },
  "Alador Plaga": { item: "Fioletowy Slam", chance: 0.47 },
  "Alastor": { item: "Czerwona Peleryna", chance: 0.01 },
  "Alex": { item: "Ko≈õƒá", chance: 0.4 },
  "Allay": { item: "Diament", chance: 0.34 },
  "Ambush": { item: "Zielony Dym", chance: 0.15 },
  "Analin Skywalker": { item: "Metal", chance: 0.02 },
  "Anita": { item: "Fioletowy Slam", chance: 0.4 },
  "Arctic Fox": { item: "Futro Lisa", chance: 0.7 },
  "Arin": { item: "Placek", chance: 0.37 },
  "Axolotl": { item: "Ryba", chance: 0.5 },
  "Balloon Boy": { item: "Balon", chance: 0.25 },
  "Ban Ban": { item: "Kie≈Ç", chance: 0.1 },
  "Barola": { item: "Ko≈õƒá Endo", chance: 0.18 },
  "Bat": { item: "Kie≈Ç Nietoperza", chance: 0.02 },
  "Batgirl": { item: "Fioletowa Peleryna", chance: 0.01 },
  "Batman": { item: "Czarna Peleryna", chance: 0.01 },
  "Bear": { item: "Miƒôso", chance: 0.8 },
  "Bee": { item: "Mi√≥d", chance: 0.4 },
  "Belos": { item: "Zielony Slam", chance: 0.38 },
  "Bendy": { item: "Atrament", chance: 0.12 },
  "Big Top": { item: "Ticket", chance: 0.23 },
  "Blaze": { item: "Ognista Pa≈Çka", chance: 0.17 },
  "Blob": { item: "Kable", chance: 0.6 },
  "Bo": { item: "≈Åuk", chance: 0.05 },
  "Boba Fett": { item: "Amunicja", chance: 0.4 },
  "Bon Bon": { item: "Ucho Kr√≥lika", chance: 0.32 },
  "Borys": { item: "Atrament", chance: 0.07 },
  "Burntrap": { item: "Ucho Kr√≥lika", chance: 0.4 },
  "Buzz": { item: "Gwizdek", chance: 0.11 },
  "Camel": { item: "Miƒôso", chance: 0.75 },
  "Candy Cat": { item: "Cukierek", chance: 0.55 },
  "Capitan Ameryca": { item: "Tarcza", chance: 0.15 },
  "Cartoon Bunny": { item: "Karton", chance: 0.3 },
  "Cat": { item: "Futro Kota", chance: 0.7 },
  "Cat Nap": { item: "Fioletowe Futro", chance: 0.35 },
  "Cave Spider": { item: "Pajƒôczyna", chance: 0.3 },
  "Charged Creeper": { item: "Elektryczny Proch", chance: 0.1 },
  "Charlie": { item: "Czarna Muszka", chance: 0.45 },
  "Chica": { item: "Ko≈õƒá Endo", chance: 0.1 },
  "Cole": { item: "Ziemia", chance: 0.14 },
  "Colt": { item: "Amunicja", chance: 0.24 },
  "Cow": { item: "Mleko", chance: 0.33 },
  "Creacing": { item: "≈ªywica", chance: 0.05 },
  "Creeper": { item: "Proch", chance: 0.2 },
  "Cryptor": { item: "Kable", chance: 0.34 },    
  "Cz≈Çowiek Kot": { item: "Futro Kota", chance: 0.21 },    
  "Cz≈Çowiek Lis": { item: "Pomara≈Ñczowy W≈Ços", chance: 0.35 },    
  "Cz≈Çowiek Pies": { item: "Maska Psa", chance: 0.01 },   
  "Cz≈Çowiek Wilk": { item: "Kie≈Ç", chance: 0.12 },    
  "Enderman": { item: "Ender Per≈Ça", chance: 0.3 },
  "Enit": { item: "BrƒÖzowe Futro", chance: 0.35 },
  "Evil Ban Ban": { item: "Kie≈Ç", chance: 0.2 },
  "Foxy": { item: "Ko≈õƒá Endo", chance: 0.12 },
  "Freddy": { item: "Ko≈õƒá Endo", chance: 0.1 },
  "Ghast": { item: "Kula Ognia", chance: 0.28 },
  "Golden Freddy": { item: "Z≈Çoto", chance: 0.05 },
  "Happy Ghast": { item: "Kula Ognia", chance: 0.14 },
  "Huggy Wugg": { item: "Niebieska Linka", chance: 0.28 },
  "Kee Kee": { item: "Klucz", chance: 0.05 },
  "Ink Demon": { item: "Atrament", chance: 0.2 },
  "Iron Golem": { item: "≈ªelazo", chance: 0.8 },
  "Jango Fett": { item: "Amunicja", chance: 0.3 },
  "Mangle": { item: "Ko≈õƒá Endo", chance: 0.32 },
  "Nab Nab": { item: "Kie≈Ç", chance: 0.15 },
  "Pig": { item: "Miƒôso", chance: 0.5 },
  "Puppet": { item: "Prezent", chance: 0.22 },
  "Red Man": { item: "Czerwony Patyk", chance: 0.4 },
  "Rush": { item: "Czarny Dym", chance: 0.15 },
  "Seek": { item: "Atrament", chance: 0.25 },
  "Shadow": { item: "Czarny W≈Ços", chance: 0.25 },
  "Skeleton": { item: "Ko≈õƒá", chance: 0.7 },
  "Sonic": { item: "Niebieski W≈Ços", chance: 0.25 },
  "Spider": { item: "Pajƒôczyna", chance: 0.3 },
  "Spiderman": { item: "Pajƒôczyna", chance: 0.36 },
  "Steve": { item: "Ko≈õƒá", chance: 0.4 },
  "Stickmam": { item: "Patyk", chance: 0.5 },
  "Tails": { item: "≈ª√≥≈Çty W≈Ços", chance: 0.25 },
  "The Deer": { item: "Rogi Jelonka", chance: 0.6 },
  "Toy Bonnie": { item: "Metal", chance: 0.01 },
  "Toy Chica": { item: "Metal", chance: 0.01 },
  "Toy Freddy": { item: "Metal", chance: 0.01 },
  "Wednesday": { item: "Czarna Peleryna", chance: 0.03 },
  "White Rabbit": { item: "Karton", chance: 0.64 },
  "Wither Skeleton": { item: "Czarna Ko≈õƒá", chance: 0.7 },
  "Zombie": { item: "Ko≈õƒá", chance: 0.4 }
};

// üì¶ Itemy (dodajƒÖ statystyki)
const shopItems = [
  { name: "Kryszta≈Çowy miecz", cost: 800, target: "Dorian", bonus: { atk: 4 } },
  { name: "Pluszak", cost: 300, target: "Natalka", bonus: { heal: 1 } },
  { name: "Sk√≥rzana Zbroja", cost: 500, target: "≈Åukasz", bonus: { hp: 5 } },
  { name: "Kamienny Sztylet", cost: 600, target: "Dawid", bonus: { atk: 3 } },
  { name: "Mityczna Tarcza", cost: 800, target: "≈Åukasz", bonus: { hp: 8 } },
  { name: "Amulet Mocy", cost: 1200, target: "Dorian", bonus: { atk: 6 } },
  { name: "Eliksir ≈ªycia", cost: 600, target: "Natalka", bonus: { heal: 2 } },
  { name: "Zbroja Smoka", cost: 1000, target: "Dawid", bonus: { hp: 10 } },
  { name: "Sztylet Cienia", cost: 600, target: "Nataniel", bonus: { atk: 3 } },
  { name: "Pier≈õcie≈Ñ Leczenia", cost: 300, target: "Natalka", bonus: { heal: 1 } },
  { name: "He≈Çm Bohatera", cost: 400, target: "Oliwier", bonus: { hp: 4 } },
  { name: "M≈Çot Wojownika", cost: 1000, target: "Max", bonus: { atk: 5 } },
  { name: "Peleryna Cienia", cost: 600, target: "Lena1", bonus: { hp: 6 } },
  { name: "Mikstura Regeneracji", cost: 600, target: "Dawid", bonus: { heal: 2 } },
  { name: "Amulet ≈öniegu", cost: 600, target: "Rosti", bonus: { hp: 4, atk: 1 } },
  { name: "Sztylet Zdrady", cost: 200, target: "Kacper3", bonus: { atk: 1 } },
  { name: "Pier≈õcie≈Ñ Ochrony", cost: 800, target: "Lena1", bonus: { hp: 8 } },
  { name: "He≈Çm Wojownika", cost: 500, target: "Max", bonus: { hp: 5 } },
  { name: "Koszula Lecznicza", cost: 300, target: "Ewa2", bonus: { heal: 1 } },
  { name: "Zbroja z tost√≥w", cost: 400, target: "Rosti", bonus: { hp: 4 } },
  { name: "Tarcza Smoczego Oddechu", cost: 1000, target: "Kacper1", bonus: { hp: 10 } },
  { name: "Miecz Ognia", cost: 400, target: "Dawid", bonus: { atk: 2 } }
];

// üé® Skiny (zmieniajƒÖ wyglƒÖd)
const shopSkins = [
  { name: "Claasic Dawid", cost: 100, target: "Dawid", file: "dawid_skin01.png" },
  { name: "Claasic Natalka", cost: 100, target: "Natalka", file: "natalka_skin01.png" },
  { name: "Claasic Rosti", cost: 100, target: "Rosti", file: "rosti_skin01.png" },
  { name: "Claasic Ksawery", cost: 100, target: "Ksawery", file: "ksawery_skin01.png" },
  { name: "Claasic Gabrysia", cost: 100, target: "Gabrysia", file: "gabrysia_skin01.png" },
  { name: "Claasic Milena", cost: 100, target: "Milena", file: "milena_skin01.png" },
  { name: "Claasic Ola", cost: 100, target: "Ola", file: "ola_skin01.png" },
  { name: "Claasic Karol", cost: 100, target: "Karol", file: "karol_skin01.png" }
];

let selectedMap = null;
let boughtItems = [];       
let boughtSkins = {}; 

let shopOfferChar;         
let shopOfferItem;          
let shopOfferSkin;        

let savedInventory = localStorage.getItem("inventory");
let inventory;

try {
  const parsed = JSON.parse(savedInventory);
  inventory = Array.isArray(parsed) ? parsed : [];
} catch {
  inventory = [];
}

let teamSlots = 3;           
let slotUpgradeCost = 200;  
let maxEnemies = 1;
let upgradeCost = 500;
let currentEnemy;
let currentLevel = 0;
let money = 0;
let shopOffer;
let skins = {};

let availableCharacters = [...baseCharacters]; 
let playerTeam = [];

function saveGame() {
  localStorage.setItem("playerTeam", JSON.stringify(playerTeam));
  localStorage.setItem("availableCharacters", JSON.stringify(availableCharacters));
  localStorage.setItem("money", money);
  localStorage.setItem("currentLevel", currentLevel);
  localStorage.setItem("skins", JSON.stringify(skins));
  localStorage.setItem("teamSlots", teamSlots); 
  localStorage.setItem("inventory", JSON.stringify(inventory));
  localStorage.setItem("slotUpgradeCost", slotUpgradeCost); 
  localStorage.setItem("upgradeCost", upgradeCost); 
}

function saveInventory() {
  localStorage.setItem("inventory", JSON.stringify(inventory));
}

function loadGame() {
  const savedTeam = localStorage.getItem("playerTeam");
  const savedAvailable = localStorage.getItem("availableCharacters");
  const savedMoney = localStorage.getItem("money");
  const savedLevel = localStorage.getItem("currentLevel");
  const savedSkins = localStorage.getItem("skins");
  const savedInvetory = localStorage.getItem("inventory");
  const savedTeamSlots = localStorage.getItem("teamSlots");
  const savedSlotCost = localStorage.getItem("slotUpgradeCost");
  const savedupgradeCost = localStorage.getItem("upgradeCost");

  if (savedSkins) skins = JSON.parse(savedSkins);

  if (savedAvailable) {
    availableCharacters = JSON.parse(savedAvailable);
  } else {
    availableCharacters = []; 
  }


  if (savedTeam) playerTeam = JSON.parse(savedTeam);
  if (savedMoney) money = parseInt(savedMoney);
  if (savedLevel) currentLevel = parseInt(savedLevel);
  if (savedInvetory) currentLevel = parseInt(savedInvetory);
  if (savedTeamSlots) teamSlots = parseInt(savedTeamSlots);
  if (savedSlotCost) slotUpgradeCost = parseInt(savedSlotCost);
  if (savedupgradeCost) upgradeCost = parseInt(savedupgradeCost);

  document.getElementById("money").innerText = money;
  document.getElementById("mainMoney").innerText = money;
}

const craftingRecipes = [
  { 
    input: { name: "Czarny W≈Ços", count: 7 }, 
    output: { name: "Czarna Linka", count: 1 } 
  },
  { 
    input: { name: "Niebieski W≈Ços", count: 7 }, 
    output: { name: "Niebieska Linka", count: 1 } 
  },
  { 
    input: { name: "≈ª√≥≈Çty W≈Ços", count: 7 }, 
    output: { name: "≈ª√≥≈Çta Linka", count: 1 } 
  },
  { 
    input: { name: "≈ªelazo", count: 2 }, 
    output: { name: "Metal", count: 1 } 
  }
];

const upgradeRecipes = [
  {
    name: "Ko≈õcisty Sztylet",
    cost: [
      { name: "Ko≈õƒá", count: 2 },
      { name: "Czarna linka", count: 10 }
    ],
    bonus: { atk: 1 },
    description: "+1 Ataku dla wybranej postaci"
  },
  {
    name: "Metalowa Proca",
    cost: [
      { name: "Ko≈õƒá Endo", count: 2 },
      { name: "Czarna linka", count: 1 }
    ],
    bonus: { atk: 2 },
    description: "+2 Ataku dla wybranej postaci"
  },
  {
    name: "Metalowa Zbroja",
    cost: [
      { name: "Metal", count: 8 }
    ],
    bonus: { hp: 4 },
    description: "+4 HP dla wybranej postaci"
  },
  {
    name: "≈ªelazna W≈Ç√≥cznia",
    cost: [
      { name: "Patyk", count: 4 },
      { name: "Czarna linka", count: 2 },
      { name: "≈ªelazo", count: 4 }
    ],
    bonus: { atk: 3 },
    description: "+3 Ataku dla wybranej postaci"
  }
];

function openCrafting() {
  renderCrafting();
  showScreen("craftingScreen");
}

function renderCrafting() {
  const div = document.getElementById("craftingList");
  div.innerHTML = "<h3>üî® Przedmioty</h3>";
  craftingRecipes.forEach(recipe => {
    const inputItem = recipe.input;
    const outputItem = recipe.output;
    const invItem = inventory.find(i => i.name === inputItem.name);
    const hasEnough = invItem && invItem.count >= inputItem.count;

    const recipeDiv = document.createElement("div");
    recipeDiv.className = "card";
    recipeDiv.innerHTML = `
      <b>${inputItem.count}√ó ${inputItem.name}</b> ‚Üí 
      <b>${outputItem.count}√ó ${outputItem.name}</b><br>
      ${hasEnough 
        ? `<button class="green" onclick="craftItem('${inputItem.name}', ${inputItem.count}, '${outputItem.name}', ${outputItem.count})">Stw√≥rz</button>`
        : `<button class="red" disabled>Brak materia≈Ç√≥w</button>`}
    `;
    div.appendChild(recipeDiv);
  });

  div.innerHTML += "<h3>‚öîÔ∏è Ulepszenia postaci</h3>";

  upgradeRecipes.forEach(recipe => {
    let hasAll = true;
    for (let c of recipe.cost) {
      const invItem = inventory.find(i => i.name === c.name);
      if (!invItem || invItem.count < c.count) {
        hasAll = false;
        break;
      }
    }

    const recipeDiv = document.createElement("div");
    recipeDiv.className = "card";
    recipeDiv.innerHTML = `
      <b>${recipe.name}</b><br>
      ${recipe.cost.map(c => `${c.count}√ó ${c.name}`).join(" + ")}<br>
      Efekt: ${recipe.description}<br><br>
      ${hasAll 
        ? `<button class="green" onclick="chooseCharacterForUpgrade('${recipe.name}')">Ulepsz postaƒá</button>`
        : `<button class="red" disabled>Brak materia≈Ç√≥w</button>`}
    `;
    div.appendChild(recipeDiv);
  });
}

function craftItem(inputName, inputCount, outputName, outputCount) {
  const input = inventory.find(i => i.name === inputName);
  if (!input || input.count < inputCount) {
    alert("Brak wymaganych materia≈Ç√≥w!");
    return;
  }

  input.count -= inputCount;
  if (input.count <= 0) {
    inventory = inventory.filter(i => i.name !== inputName);
  }

  const existing = inventory.find(i => i.name === outputName);
  if (existing) {
    existing.count += outputCount;
  } else {
    inventory.push({ name: outputName, count: outputCount });
  }

  log(`üß™ Stworzono ${outputName}!`);
  saveInventory();
  renderInventory();
  renderCrafting();
}

function chooseCharacterForUpgrade(recipeName) {
  const recipe = upgradeRecipes.find(r => r.name === recipeName);
  if (!recipe) return;

  if (playerTeam.length === 0) {
    alert("Nie masz ≈ºadnych postaci w dru≈ºynie!");
    return;
  }

  const names = playerTeam.map(p => p.name).join(", ");
  const chosenName = prompt(`Wybierz postaƒá do ulepszenia (${names}):`);
  if (!chosenName) return;

  const character = playerTeam.find(p => p.name.toLowerCase() === chosenName.toLowerCase());
  if (!character) {
    alert("Nie znaleziono takiej postaci w dru≈ºynie!");
    return;
  }

  craftUpgrade(recipe, character);
}

function craftUpgrade(recipe, character) {
  for (let c of recipe.cost) {
    const invItem = inventory.find(i => i.name === c.name);
    if (!invItem || invItem.count < c.count) {
      alert("Brak wymaganych materia≈Ç√≥w!");
      return;
    }
  }

  for (let c of recipe.cost) {
    const invItem = inventory.find(i => i.name === c.name);
    invItem.count -= c.count;
    if (invItem.count <= 0) {
      inventory = inventory.filter(i => i.name !== c.name);
    }
  }

  for (let stat in recipe.bonus) {
    character[stat] = (character[stat] || 0) + recipe.bonus[stat];
  }

  log(`‚öîÔ∏è ${character.name} ulepszony! +${recipe.bonus.atk} Ataku dziƒôki ${recipe.name}`);
  saveInventory();
  saveGame();
  renderInventory();
  renderCrafting();
  renderTeam();
}

function renderEnemies() {
  const div = document.getElementById("enemyStats");
  div.innerHTML = "<h3>Przeciwnicy</h3>";

  if (!currentEnemies || currentEnemies.length === 0) {
    div.innerHTML += "<p>(Brak przeciwnik√≥w)</p>";
    return;
  }

  currentEnemies.forEach((e, i) => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <b>${e.name}</b><br>
      ‚ù§Ô∏è ${e.hp}<br>
      ‚öîÔ∏è ${e.atk}
      ${e.stunned ? "<br>‚ö° Og≈Çuszony" : ""}
    `;
    div.appendChild(card);
  });
}

function renderMapOptions() {
  const div = document.getElementById("mapOptions");
  div.innerHTML = "";
  maps.forEach((map, i) => {
    const card = document.createElement("div");
    card.className = "card";
    card.style.cursor = "pointer";
    card.onclick = () => chooseMap(i);
    card.innerHTML = `
      <b>${map.name}</b><br>
      <img src="${map.file}" width="120">
    `;
    div.appendChild(card);
  });
}

function chooseMap(map) {
  selectedMap = map;
  document.getElementById("mapSelect").style.display = "none";
  startLevel(currentLevel);
}

function cancelMapSelect() {
  document.getElementById("mapSelect").style.display = "none";
  document.getElementById("mainMenu").style.display = "block";
}

function openSettings() {
  document.getElementById("mainMenu").style.display = "none";
  document.getElementById("shopScreen").style.display = "none";
  document.getElementById("settingsScreen").style.display = "block";
}

function backToMenu() {
  document.getElementById("settingsScreen").style.display = "none";
  document.getElementById("mainMenu").style.display = "block";
}

// --- Ustawienia d≈∫wiƒôk√≥w postaci ---
let characterSoundsEnabled = true;

function toggleCharacterSounds() {
  characterSoundsEnabled = !characterSoundsEnabled;
  document.getElementById("toggleSoundsBtn").innerText =
    characterSoundsEnabled ? "üîä D≈∫wiƒôki postaci: W≈ÇƒÖczone" : "üîá D≈∫wiƒôki postaci: Wy≈ÇƒÖczone";

  // je≈õli chcesz, mo≈ºesz zapisywaƒá do localStorage
  localStorage.setItem("characterSoundsEnabled", characterSoundsEnabled ? "1" : "0");
}

// Za≈Çaduj ustawienie przy starcie gry
window.addEventListener("load", () => {
  const saved = localStorage.getItem("characterSoundsEnabled");
  if (saved !== null) {
    characterSoundsEnabled = saved === "1";
    document.getElementById("toggleSoundsBtn").innerText =
      characterSoundsEnabled ? "üîä D≈∫wiƒôki postaci: W≈ÇƒÖczone" : "üîá D≈∫wiƒôki postaci: Wy≈ÇƒÖczone";
  }
});

// --- Reset gry ---
function resetGameProgress() {
  if (confirm("Na pewno chcesz zresetowaƒá grƒô? Stracisz postƒôpy!")) {
    localStorage.clear();
    location.reload();
  }
}

// --- Funkcja odtwarzania d≈∫wiƒôku ---
function playSound(path) {
  if (!path || !characterSoundsEnabled) return; // üö´ brak d≈∫wiƒôku je≈õli OFF
  const audio = new Audio(path);
  audio.play().catch(err => console.warn("Audio error:", err));
}

function buyTeamSlot() {
  if (money < slotUpgradeCost) {
    alert(`Za ma≈Ço üíµ! Potrzebujesz ${slotUpgradeCost} üíµ.`);
    return;
  }

  money -= slotUpgradeCost;  
  teamSlots += 1;          
  slotUpgradeCost += 200;   

  alert(`Nowy slot w dru≈ºynie odblokowany! Masz teraz ${teamSlots} slot√≥w.`);

  // Zaktualizuj wy≈õwietlane pieniƒÖdze i przycisk
  document.getElementById("money").innerText = money;
  renderShop();
  saveGame();
}

function buyEnemyUpgrade() {
  if (money < upgradeCost) {
    alert("Za ma≈Ço monet!");
    return;
  }
  money -= upgradeCost;
  maxEnemies++;
  upgradeCost += 500;
  alert(`Kupiono ulepszenie! Teraz mo≈ºe pojawiƒá siƒô do ${maxEnemies} przeciwnik√≥w.`);
  document.getElementById("upgradeCost").innerText = upgradeCost;
  document.getElementById("money").innerText = money;
  document.getElementById("mainMoney").innerText = money;
  saveGame();
}

function init() {
  const selectDiv = document.getElementById("characterSelect");
  selectDiv.innerHTML = "";
  
  baseCharacters.forEach((ch, i) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <b>${ch.name}</b><br>
      Atak: ${ch.atk}<br>
      HP: ${ch.hp}<br>
      <button class='green' onclick='chooseCharacter(${i})'>Wybierz</button>`;
    selectDiv.appendChild(div);
  });

  updateShop();
  loadGame();
  renderTeam();
}

function renderTargetSelect() {
  const div = document.getElementById("targetSelect");
  div.innerHTML = "<h3>üéØ Wybierz cele ataku</h3>";

  if (!playerTeam || playerTeam.length === 0 || !currentEnemies || currentEnemies.length === 0) {
    div.innerHTML += "<p>(Brak wyboru ‚Äì walka nie trwa)</p>";
    return;
  }

  playerTeam.forEach((p, i) => {
    let row = document.createElement("div");
    row.className = "target-row";

    let label = document.createElement("span");
    label.innerHTML = `<b>${p.name}</b> atakuje: `;

    let select = document.createElement("select");
    select.className = "target-select";
    select.id = `target-${i}`;

    currentEnemies.forEach((e, j) => {
      let opt = document.createElement("option");
      opt.value = j;
      opt.text = `${e.name} (‚ù§Ô∏è${e.hp})`;
      select.appendChild(opt);
    });

    row.appendChild(label);
    row.appendChild(select);
    div.appendChild(row);
  });
}

function playSound(path) {
  if (!path || !characterSoundsEnabled) return; // üö´ brak d≈∫wiƒôku je≈õli OFF

  const audio = new Audio(path);

  audio.onerror = () => {
    console.warn("Nie mo≈ºna za≈Çadowaƒá pliku:", path);
  };

  audio.play().catch(err => {
    console.warn("B≈ÇƒÖd odtwarzania:", path, err);
  });
}

function renderTeam() {
  const teamDiv = document.getElementById("teamDisplay");
  teamDiv.innerHTML = "";

  playerTeam = playerTeam || [];
  availableCharacters = availableCharacters || [];
  skins = skins || {};

  // Dru≈ºyna gracza
  if (playerTeam.length === 0) {
    teamDiv.innerHTML = "<p>(Brak postaci w dru≈ºynie)</p>";
  } else {
    playerTeam.forEach((p, index) => {
      const div = document.createElement("div");
      div.className = "card";

      let skinFile = (skins[p.name] && skins[p.name].length > 0) ? skins[p.name][0] : null;

      div.innerHTML = `
        <b>${p.name || "Nieznana"}</b><br>
        ${skinFile ? `<img src="${skinFile}" width="100"><br>` : ""}
        Atak: ${p.atk || 0}<br>
        HP: ${p.hp || 0}<br>
        <button onclick="removeFromTeam(${index})">Usu≈Ñ</button>
      `;
      teamDiv.appendChild(div);
    });
  }

  // Dostƒôpne postacie
  const selectDiv = document.getElementById("characterSelect");
  selectDiv.innerHTML = "<h3>Dostƒôpne postacie</h3>";

  availableCharacters.forEach((ch) => {
    if (!playerTeam.some(p => p.name === ch.name)) { // bezpieczniejsze ni≈º find
      const div = document.createElement("div");
      div.className = "card";

      let skinFile = (skins[ch.name] && skins[ch.name].length > 0) ? skins[ch.name][0] : null;

      div.innerHTML = `
        <b>${ch.name || "Nieznana"}</b><br>
        ${skinFile ? `<img src="${skinFile}" width="100"><br>` : ""}
        Atak: ${ch.atk || 0}<br>
        HP: ${ch.hp || 0}<br>
        <button class='green' onclick='addToTeam("${ch.name}")'>Za≈Ç√≥≈º</button>
      `;
      selectDiv.appendChild(div);
    }
  });
}

function addToTeam(name) {
  if (playerTeam.length >= teamSlots) {
    alert(`Nie mo≈ºesz dodaƒá wiƒôcej postaci! Kup slot w sklepie.`);
    return;
  }
  // znajd≈∫ postaƒá w availableCharacters po nazwie
  let char = availableCharacters.find(c => c.name === name);
  if (char) {
    playerTeam.push(enhanceCharacter(char));
    saveGame();
    renderTeam();
  }
}

function openInventory() {
  renderInventory();
  showScreen("inventoryScreen");
}

function renderInventory() {
  const invDiv = document.getElementById("inventoryList");
  if (!inventory.length) {
    invDiv.innerHTML = "<p>Brak przedmiot√≥w üòî</p>";
    return;
  }

  invDiv.innerHTML = inventory.map(item => `
    <div class="card">
      <b>${item.name}</b><br>
      Ilo≈õƒá: ${item.count || 1}
    </div>
  `).join("");
}

function removeFromTeam(i) {
  playerTeam.splice(i, 1);
  saveGame();
  renderTeam();
}

function removeCharacter(index) {
  const removed = playerTeam.splice(index, 1)[0];
  alert(`${removed.name} zosta≈Ç usuniƒôty z dru≈ºyny.`);
  saveGame();
  renderTeam();
}

function chooseCharacter(i) {
  if (playerTeam.length < 3) {
    playerTeam.push(enhanceCharacter(baseCharacters[i]));
    alert(`${baseCharacters[i].name} dodany do dru≈ºyny!`);
    saveGame();
    renderTeam();
  } else {
    alert("Masz ju≈º 3 postacie!");
  }
}

function startGame() {
  if (playerTeam.length === 0) {
    alert("Wybierz chocia≈º jednƒÖ postaƒá!");
    return;
  }
  document.getElementById("mainMenu").style.display = "none";
  document.getElementById("mapSelect").style.display = "block";
}

function startLevel(level) {
  currentLevel = level;
  document.getElementById("battleScreen").style.display = "block";
  document.getElementById("shopScreen").style.display = "none"; // üîí sklep ukryty na starcie
  document.getElementById("mainMenu").style.display = "none";
  document.getElementById("mapSelect").style.display = "none";

  resetTeamHp();

  // wyb√≥r przeciwnik√≥w wg mapy
  let pool;
  if (selectedMap === "minecraft") pool = enemiesMinecraft;
  else if (selectedMap === "fnaf") pool = enemiesFnaf;
  else if (selectedMap === "legoninjago") pool = enemiesLegoNinjago;
  else if (selectedMap === "hazbinhotel") pool = enemiesHazbinHotel;
  else if (selectedMap === "theowlhouse") pool = enemiesTheOwlHouse;
  else if (selectedMap === "doors") pool = enemiesDoors;
  else if (selectedMap === "furas") pool = enemiesFuras;
  else if (selectedMap === "wednesday") pool = enemiesWednesday;
  else if (selectedMap === "bendy") pool = enemiesBendy;
  else if (selectedMap === "poppy") pool = enemiesPoppy;
  else if (selectedMap === "marver") pool = enemiesMarver;
  else if (selectedMap === "dc") pool = enemiesDc;
  else if (selectedMap === "banban") pool = enemiesBanBan;
  else if (selectedMap === "brawlstars") pool = enemiesBrawlStart;
  else if (selectedMap === "99") pool = enemies99;
  else if (selectedMap === "starwars") pool = enemiesStarWars;
  else if (selectedMap === "sonic") pool = enemiesSonic;
  else pool = enemiesTheShadow;

currentEnemies = [];
for (let i = 0; i < maxEnemies; i++) {
  let enemy = JSON.parse(JSON.stringify(pool[Math.floor(Math.random() * pool.length)]));
  currentEnemies.push(enemy);
}

  renderTeam();
  renderEnemies();
  renderShop();
  renderStats();
  renderTargetSelect();
  document.getElementById("battleLog").innerHTML = "";
}

function resetTeamHp() {
  playerTeam.forEach(p => p.hp = p.baseHp);
}

function enhanceCharacter(ch) {
  return { ...ch, hp: ch.hp, baseHp: ch.hp };
}

function renderStats() {
  document.getElementById("playerStats").innerHTML =
    "<h3>Dru≈ºyna</h3>" +
    playerTeam.map(p => `${p.name}: ‚ù§Ô∏è ${p.hp} | ‚öîÔ∏è ${p.atk}${p.heal ? ` | üíö Heal: ${p.heal}` : ""}${p.stun ? " | ‚ö° Stun" : ""}`).join("<br>");

  document.getElementById("enemyStats").innerHTML =
    "<h3>Przeciwnicy</h3>" +
    currentEnemies.map(e => `${e.name}: ‚ù§Ô∏è ${e.hp} | ‚öîÔ∏è ${e.atk}${e.heal ? ` | üíö Heal: ${e.heal}` : ""}${e.stunned ? " | ‚ö° Og≈Çuszony" : ""}`).join("<br>");
}

function attack() {
    if (!currentEnemies || currentEnemies.length === 0) return;

    playerTeam.forEach((p, i) => {
        let targetIndex = parseInt(document.getElementById(`target-${i}`)?.value);
        let enemy = currentEnemies[targetIndex] || currentEnemies[Math.floor(Math.random() * currentEnemies.length)];
        if (p.sound) playSound(p.sound);        
        if (!enemy) return;

        // Stun
        if (p.stun) {
            if ((currentLevel - (p.stun.lastUsed || -p.stun.cooldown)) >= p.stun.cooldown) {
                enemy.stunned = p.stun.duration;
                p.stun.lastUsed = currentLevel;
                log(`${p.name} og≈Çusza ${enemy.name} na ${p.stun.duration} tury!`);
            }
        }

        // Multiattack
        if (p.multiAttack) {
            for (let j = 0; j < p.multiAttack; j++) {
                let multiTarget = currentEnemies[Math.floor(Math.random() * currentEnemies.length)];
                if (multiTarget) {
                    multiTarget.hp -= p.atk;
                    if (multiTarget.hp < 0) multiTarget.hp = 0;
                    log(`${p.name} atakuje ${multiTarget.name} za ${p.atk}!`);
                }
            }
        } else {
            // Normalny atak
            enemy.hp = (Number(enemy.hp) || 0) - (Number(p.atk) || 0);
            if (enemy.hp < 0) enemy.hp = 0;
            log(`${p.name} atakuje ${enemy.name} za ${p.atk}!`);
        }
    });

    // Leczenie
    ["Natalka", "Xantia", "Ewa2", "Julka", "Oskar", "Rashana", "Lena2"].forEach(name => {
        const healer = playerTeam.find(p => p.name === name);
        if (healer) {
            let ally = playerTeam[Math.floor(Math.random() * playerTeam.length)];
            ally.hp = (Number(ally.hp) || 0) + (Number(healer.heal) || 0);
            log(`${healer.name} uleczy≈Ça ${ally.name} o ${healer.heal} HP!`);
        }
    });

currentEnemies.forEach(e => {
  if (e.hp <= 0) {
    // üí∞ Nagroda za pokonanie wroga
    const reward = e.reward || 5; // domy≈õlnie 5 monet, je≈õli brak pola reward
    money += reward;
    log(`üí∞ Pokona≈Çe≈õ ${e.name} i zdoby≈Çe≈õ ${reward} monet!`);

    // Zaktualizuj wy≈õwietlanie pieniƒôdzy
    document.getElementById("money").innerText = money;
    document.getElementById("mainMoney").innerText = money;

    // üì¶ Dropy (je≈õli sƒÖ zdefiniowane)
    const dropData = enemyDrops[e.name];
    if (dropData && Math.random() < dropData.chance) {
      const drop = dropData.item;
      const existing = inventory.find(i => i.name === drop);
      if (existing) {
        existing.count = (existing.count || 1) + 1;
      } else {
        inventory.push({ name: drop, count: 1 });
      }
      log(`üéÅ ${e.name} upu≈õci≈Ç przedmiot: ${drop}!`);
      saveInventory();
    }
  }
});

// usu≈Ñ martwych przeciwnik√≥w
currentEnemies = currentEnemies.filter(e => e.hp > 0);

if (currentEnemies.length === 0) {
  log("üèÜ Pokona≈Çe≈õ wszystkich przeciwnik√≥w!");

  // ‚ú® nie dodajemy ju≈º sta≈Çej nagrody ‚Äî nagrody zosta≈Çy zebrane indywidualnie powy≈ºej

  currentLevel++;
  resetTeamHp();
  saveGame();

  // üëÅÔ∏è Powr√≥t do menu
  document.getElementById("battleScreen").style.display = "none";
  document.getElementById("mainMenu").style.display = "block";
  return;
}

let target = playerTeam[Math.floor(Math.random() * playerTeam.length)];

currentEnemies.forEach(attacker => {
    if (!attacker) return;
    if (attacker.sound) playSound(attacker.sound);

    if (!attacker.stunned || attacker.stunned <= 0) {
        if (!target) return; // brak celu = koniec ataku
        target.hp = (Number(target.hp) || 0) - (Number(attacker.atk) || 0);

        if (target.hp <= 0) {
            log(`${target.name} poleg≈Ç i znika z dru≈ºyny!`);
            playerTeam = playerTeam.filter(p => p.hp > 0);

            // je≈ºeli wszyscy martwi ‚Üí przerwij
            if (playerTeam.length === 0) {
                log("Ca≈Ça dru≈ºyna zginƒô≈Ça!");
                return;
            }

            // wyb√≥r nowego celu
            target = playerTeam[Math.floor(Math.random() * playerTeam.length)];
        }
    } else {
        attacker.stunned--;
        log(`${attacker.name} jest og≈Çuszony i nie atakuje!`);
    }
});

    // --- Sprawdzenie przegranej ---
    if (playerTeam.every(p => p.hp <= 0)) {
        alert("Przegra≈Çe≈õ! Musisz powt√≥rzyƒá ten poziom.");
        resetTeamHp();
        loadGame();
        document.getElementById("battleScreen").style.display = "none";
        document.getElementById("mainMenu").style.display = "block";
        return;
    }

    renderStats();
    renderTargetSelect(); // od≈õwie≈ºenie select√≥w po turze
    saveGame();
}

    function log(msg) {
      document.getElementById("battleLog").innerHTML += msg + "<br>";
    }

    function openShop() {
      document.getElementById("mainMenu").style.display = "none";
      document.getElementById("shopScreen").style.display = "block";
      renderShop();
    }

    function closeShop() {
      document.getElementById("shopScreen").style.display = "none";
      document.getElementById("mainMenu").style.display = "block";
    }

function updateShop() {
  // losuj postaƒá
  shopOfferChar = shopCharacters[Math.floor(Math.random() * shopCharacters.length)];

  // losuj item
  shopOfferItem = shopItems[Math.floor(Math.random() * shopItems.length)];

  // losuj skin
  shopOfferSkin = shopSkins[Math.floor(Math.random() * shopSkins.length)];

  renderShop();
  setTimeout(updateShop, 600000); // co 10 minut reset
}

function buySkin() {
  const skin = shopOfferSkin;
  if (!skin) return;

  if (money < skin.cost) {
    alert("Za ma≈Ço kasy!");
    return;
  }

  // upewnij siƒô, ≈ºe mamy tablicƒô skin√≥w dla tej postaci
  if (!skins[skin.target]) skins[skin.target] = [];

  // sprawd≈∫, czy gracz ju≈º kupi≈Ç ten skin
  if (skins[skin.target].includes(skin.file)) {
    alert(`Masz ju≈º ten skin dla ${skin.target}!`);
    return;
  }

  // dodaj skin i odejmij pieniƒÖdze
  skins[skin.target].push(skin.file);
  money -= skin.cost;

  alert(`Kupi≈Çe≈õ ${skin.name} dla ${skin.target}!`);

  saveGame();
  renderShop();
}

function renderShop() {
  let charHTML = "";
  let itemHTML = "";
  let skinHTML = "";

  // üë§ Postaƒá w sklepie
  if (shopOfferChar) {
    charHTML = `<div class='card'><b>${shopOfferChar.name}</b><br>
      Atak: ${shopOfferChar.atk}<br>HP: ${shopOfferChar.hp}
      ${shopOfferChar.heal ? `<br>Leczy: ${shopOfferChar.heal} HP` : ""}
      <br>Koszt: ${shopOfferChar.cost} üíµ
      <br><button class='green' onclick='buyCharacter()'>Kup</button></div>`;
  }
  
  let slotHTML = `<div class='card'>
    <b>Ulepszenie slotu w dru≈ºynie</b><br>
    Koszt: ${slotUpgradeCost} üíµ<br>
    Aktualne sloty: ${teamSlots}<br>
    <button class='green' onclick='buyTeamSlot()'>Kup</button>
  </div>`;
  
let enemyUpgradeHTML = `<div class='card'>
  <b>Ulepszenie: wiƒôcej przeciwnik√≥w</b><br>
  Koszt: ${upgradeCost} üíµ<br>
  Max przeciwnik√≥w: ${maxEnemies}<br>
  <button class='green' onclick='buyEnemyUpgrade()'>Kup</button>
</div>`;

  // üéÅ Item w sklepie
  if (shopOfferItem && !boughtItems.includes(shopOfferItem.name)) {
    itemHTML = `<div class='card'><b>${shopOfferItem.name}</b><br>
      Dla: ${shopOfferItem.target}<br>
      ${shopOfferItem.bonus?.atk ? `+${shopOfferItem.bonus.atk} DMG<br>` : ""}
      ${shopOfferItem.bonus?.hp ? `+${shopOfferItem.bonus.hp} HP<br>` : ""}
      ${shopOfferItem.bonus?.heal ? `+${shopOfferItem.bonus.heal} Leczenia<br>` : ""}
      Koszt: ${shopOfferItem.cost} üíµ
      <br><button class='green' onclick='buyItem()'>Kup</button></div>`;
  }

  // üé® Skin w sklepie
  if (shopOfferSkin) {
    skinHTML = `<div class='card'><b>${shopOfferSkin.name}</b><br>
      Skin dla: ${shopOfferSkin.target}<br>
      Koszt: ${shopOfferSkin.cost} üíµ
      <br><button class='green' onclick='buySkin()'>Kup</button></div>`;
  }

  document.getElementById("shopOffer").innerHTML = `
  <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap;">
    ${charHTML}${itemHTML}${skinHTML}${slotHTML}${enemyUpgradeHTML}
  </div>`;

  document.getElementById("money").innerText = money;
}

function resetGame() {
  if (confirm("Na pewno chcesz zresetowaƒá ca≈ÇƒÖ grƒô?")) {
    // üîπ Usu≈Ñ wszystkie dane zapisane w localStorage
    localStorage.clear();

    // üîπ Zresetuj wszystkie zmienne gry
    playerTeam = [];
    availableCharacters = []; // pusty start ‚Äî Dawid zostanie dodany rƒôcznie
    money = 0;
    teamSlots = 3;
    slotUpgradeCost = 200;
    currentLevel = 0;
    boughtItems = [];
    skins = {};
    inventory = [];
    maxEnemies = 1;
    upgradeCost = 500;

    // üîπ Od≈õwie≈º licznik pieniƒôdzy
    document.getElementById("mainMoney").innerText = money;
    document.getElementById("money").innerText = money;

    // üîπ Dodaj nowego "≈õwie≈ºego" Dawida
    const newDawid = { name: "Dawid", atk: 3, hp: 20 };
    availableCharacters.push(newDawid);

    // üîπ Zapisz nowy stan gry z nowym Dawidem
    saveGame();

    // üîπ Zaktualizuj UI
    init();
    renderTeam();
    renderShop();
    renderInventory();

    alert("Gra zosta≈Ça ca≈Çkowicie zresetowana! Nowy Dawid zosta≈Ç dodany jako startowa postaƒá.");
  }
}

function buyItem() {
  if (!shopOfferItem) return;

  if (money < shopOfferItem.cost) {
    alert("Za ma≈Ço monet!");
    return;
  }

  let target = playerTeam.find(p => p.name === shopOfferItem.target);
  if (target) {
    for (let stat in shopOfferItem.bonus) {
      target[stat] = (target[stat] || 0) + shopOfferItem.bonus[stat];
      if (stat === "hp") {
        target.baseHp += shopOfferItem.bonus[stat]; // naprawa HP
      }
    }
  }

  money -= shopOfferItem.cost;
  boughtItems.push(shopOfferItem.name);
  alert(`Kupiono ${shopOfferItem.name} dla ${shopOfferItem.target}!`);

  saveGame();
  renderShop();
  renderTeam();
  renderStats();
}

function showScreen(screenId) {
  const screens = [
    "mainMenu",
    "shopScreen",
    "settingsScreen",
    "battleScreen",
    "inventoryScreen",
    "craftingScreen"
  ];

  // Ukrywa wszystkie ekrany
  screens.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = "none";
  });

  // Pokazuje tylko wybrany
  const screen = document.getElementById(screenId);
  if (screen) screen.style.display = "block";
}

function buyCharacter() {
  if (!shopOfferChar) return;

  if (money < shopOfferChar.cost) {
    alert("Za ma≈Ço kasy!");
    return;
  }

  // sprawdzamy czy ju≈º masz tƒô postaƒá
  if (
    availableCharacters.find(c => c.name === shopOfferChar.name) ||
    playerTeam.find(c => c.name === shopOfferChar.name)
  ) {
    alert("Masz ju≈º tƒô postaƒá i nie mo≈ºesz kupiƒá drugi raz!");
    return;
  }

  availableCharacters.push(shopOfferChar);
  money -= shopOfferChar.cost;
  document.getElementById("money").innerText = money;
  document.getElementById("mainMoney").innerText = money;
  alert(`Kupi≈Çe≈õ ${shopOfferChar.name}! Teraz mo≈ºesz jƒÖ za≈Ço≈ºyƒá w dru≈ºynie.`);
  
  saveGame();
  renderTeam();
  renderShop();
}

    init();
  </script>
</body>
</html>